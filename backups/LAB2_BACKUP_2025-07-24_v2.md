# Lab 2: Node.js Core Modules & File System Operations

**ğŸ“ Navigation**: [â† Main Guide](../EDUCATIONAL_GUIDE.md) | [â† Lab 1](./LAB1.md) | [Advanced Theory â†’](../EDUCATIONAL_GUIDE_ADVANCED.md)

**ğŸ¯ Lab Files**: `labs/lab2.js` | `lab2-cli-workshop/`

## Learning Objectives

### Core Skills You'll Master
- **Package.json & NPM**: Project configuration, dependencies, and scripts
- **Built-in Modules**: File System (fs), Path, OS, and Util modules
- **File Operations**: CRUD operations with JSON configuration management
- **Environment Config**: Managing development vs production settings
- **CLI Development**: Building production-ready command-line applications

### Practical Tasks
- [âœ“] Create professional Node.js project structure
- [âœ“] Build file manager CLI with CRUD operations
- [âœ“] Implement cross-platform file handling
- [âœ“] Set up environment-based configuration

## Quick Start

```bash
# Run complete lab demonstrations
node step1-package-json.js    # Package.json & NPM
node step2-builtin-modules.js # Core modules
node step3-file-operations.js # File system
node step4-environment.js     # Environment config

# Test CLI application
node index.js help
node index.js add "My first note"
node index.js list
```

## Step 1: Package.json & NPM Configuration

### Theory: Node.js Project Architecture

**Package.json** serves as the project manifest containing:
- **Dependencies**: Required packages and versions
- **Scripts**: Custom commands for development/deployment
- **Metadata**: Project info, author, license
- **Configuration**: Build tools and runtime settings

**Semantic Versioning (SemVer)**: `MAJOR.MINOR.PATCH`
- **MAJOR**: Breaking changes
- **MINOR**: New backward-compatible features  
- **PATCH**: Bug fixes

**Module Systems**:
- **CommonJS**: `require()` and `module.exports` (traditional)
- **ES Modules**: `import`/`export` (modern, requires `"type": "module"`)

### Implementation

Create `package.json`:
```json
{
  "name": "file-manager-cli",
  "version": "1.0.0",
  "description": "Professional CLI file manager built with Node.js core modules",
  "type": "module",
  "main": "index.js",
  "scripts": {
    "start": "node index.js",
    "dev": "node --watch index.js",
    "test": "node --test",
    "demo": "node step1-package-json.js && node step2-builtin-modules.js"
  },
  "dependencies": {
    "chalk": "^5.3.0",
    "dotenv": "^16.3.1"
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  },
  "keywords": ["cli", "file-manager", "nodejs", "filesystem"],
  "author": "Your Name",
  "license": "MIT"
}
```

Create `step1-package-json.js`:
```javascript
import fs from 'fs';
import path from 'path';
import { execSync } from 'child_process';

console.log('=== Package.json & NPM Demonstration ===\n');

// Read and analyze package.json
const packagePath = './package.json';
const packageData = JSON.parse(fs.readFileSync(packagePath, 'utf8'));

console.log('ğŸ“¦ Package Analysis:');
console.log(`  Name: ${packageData.name}`);
console.log(`  Version: ${packageData.version}`);
console.log(`  Module Type: ${packageData.type || 'CommonJS'}`);

console.log('\nğŸ“š Dependencies:');
Object.entries(packageData.dependencies || {}).forEach(([name, version]) => {
  console.log(`  ${name}: ${version}`);
});

console.log('\nğŸ› ï¸ Scripts:');
Object.entries(packageData.scripts || {}).forEach(([name, command]) => {
  console.log(`  ${name}: ${command}`);
});

console.log('\nâœ… Package.json configuration completed!');
```

**Output**:
```
=== Package.json & NPM Demonstration ===

ğŸ“¦ Package Analysis:
  Name: file-manager-cli
  Version: 1.0.0
  Module Type: module

ğŸ“š Dependencies:
  chalk: ^5.3.0
  dotenv: ^16.3.1

ğŸ› ï¸ Scripts:
  start: node index.js
  dev: node --watch index.js

âœ… Package.json configuration completed!
```

## Step 2: Built-in Modules (fs, path, os, util)

### Theory: Core Module Ecosystem

**Built-in modules** provide:
- **Zero Dependencies**: No external packages required
- **Optimized Performance**: Written in C++ for efficiency
- **Stable APIs**: Well-tested and documented

**Key Modules**:
- **fs**: File system operations
- **path**: Cross-platform path utilities
- **os**: Operating system information
- **util**: Debugging and object inspection

### Implementation

Create `step2-builtin-modules.js`:
```javascript
import fs from 'fs';
import path from 'path';
import os from 'os';
import util from 'util';

console.log('=== Built-in Modules Demonstration ===\n');

// OS Module - System Information
console.log('ğŸ–¥ï¸ System Information:');
console.log(`  Platform: ${os.platform()}`);
console.log(`  Architecture: ${os.arch()}`);
console.log(`  CPU Cores: ${os.cpus().length}`);
console.log(`  Total Memory: ${(os.totalmem() / 1024 / 1024 / 1024).toFixed(2)} GB`);

// Path Module - Cross-platform paths
console.log('\nğŸ“ Path Operations:');
const samplePath = path.join('data', 'config', 'app.json');
console.log(`  Joined path: ${samplePath}`);
console.log(`  Directory: ${path.dirname(samplePath)}`);
console.log(`  Filename: ${path.basename(samplePath)}`);
console.log(`  Extension: ${path.extname(samplePath)}`);

// FS Module - File operations
console.log('\nğŸ“‚ File System:');
if (!fs.existsSync('./data')) {
  fs.mkdirSync('./data', { recursive: true });
  console.log('  âœ… Created data directory');
}
console.log(`  Current directory: ${process.cwd()}`);

// Util Module - Object inspection
console.log('\nğŸ” Util Module:');
const sampleObject = { name: 'Lab2', modules: ['fs', 'path', 'os'] };
console.log('  Object inspection:');
console.log(util.inspect(sampleObject, { colors: true, depth: 2 }));

console.log('\nâœ… Built-in modules demonstration completed!');
```

**Output**:
```
=== Built-in Modules Demonstration ===

ğŸ–¥ï¸ System Information:
  Platform: win32
  Architecture: x64
  CPU Cores: 6
  Total Memory: 7.00 GB

ğŸ“ Path Operations:
  Joined path: data\config\app.json
  Directory: data\config
  Filename: app.json
  Extension: .json

ğŸ“‚ File System:
  âœ… Created data directory
  Current directory: E:\New Folder(1)\Downloads\telemed\lab2-cli-workshop

âœ… Built-in modules demonstration completed!
```

## Step 3: File System Operations & JSON Configuration

### Theory: File System Patterns

**CRUD Operations**:
- **Create**: Writing new files/directories
- **Read**: Reading file contents and metadata
- **Update**: Modifying existing files
- **Delete**: Removing files/directories

**Best Practices**:
- Use `fs/promises` for async operations
- Handle errors gracefully
- Validate data before writing
- Create backups before destructive operations

### Implementation

Create `step3-file-operations.js`:
```javascript
import fs from 'fs/promises';
import fsSync from 'fs';
import path from 'path';

console.log('=== File System Operations & JSON Configuration ===\n');

// Configuration object
const config = {
  appName: 'File Manager CLI',
  version: '1.0.0',
  maxFiles: 1000,
  autoBackup: true,
  allowedExtensions: ['.txt', '.json', '.md']
};

async function demonstrateFileOperations() {
  try {
    // Create directory structure
    console.log('ğŸ“ Creating directories:');
    const dirs = ['./data', './data/backups', './data/backups/daily'];
    for (const dir of dirs) {
      await fs.mkdir(dir, { recursive: true });
      console.log(`  âœ… ${dir}`);
    }

    // Write configuration file
    console.log('\nâš™ï¸ Creating configuration:');
    const configPath = './data/config.json';
    await fs.writeFile(configPath, JSON.stringify(config, null, 2));
    const stats = await fs.stat(configPath);
    console.log(`  âœ… ${configPath} (${stats.size} bytes)`);

    // Read and display configuration
    console.log('\nğŸ“– Reading configuration:');
    const configData = JSON.parse(await fs.readFile(configPath, 'utf8'));
    console.log(`  App: ${configData.appName} v${configData.version}`);
    console.log(`  Max Files: ${configData.maxFiles}`);

    // Create sample notes
    console.log('\nğŸ“ Creating sample notes:');
    const notes = [
      { id: Date.now(), title: 'Lab 2 Notes', content: 'Learning file operations' },
      { id: Date.now() + 1, title: 'Config Example', content: 'JSON configuration demo' }
    ];
    await fs.writeFile('./data/notes.json', JSON.stringify(notes, null, 2));
    console.log(`  âœ… Created ${notes.length} notes`);

    // List directory contents
    console.log('\nğŸ“‚ Directory contents:');
    const files = await fs.readdir('./data');
    for (const file of files) {
      const filepath = path.join('./data', file);
      const stats = await fs.stat(filepath);
      const type = stats.isDirectory() ? 'ğŸ“' : 'ğŸ“„';
      const size = stats.isFile() ? `${stats.size} bytes` : 'N/A';
      console.log(`  ${type} ${file} (${size})`);
    }

    console.log('\nâœ… File operations completed successfully!');
  } catch (error) {
    console.error('âŒ Error:', error.message);
  }
}

await demonstrateFileOperations();
```

**Output**:
```
=== File System Operations & JSON Configuration ===

ğŸ“ Creating directories:
  âœ… ./data
  âœ… ./data/backups
  âœ… ./data/backups/daily

âš™ï¸ Creating configuration:
  âœ… ./data/config.json (108 bytes)

ğŸ“– Reading configuration:
  App: File Manager CLI v1.0.0
  Max Files: 1000

ğŸ“ Creating sample notes:
  âœ… Created 2 notes

ğŸ“‚ Directory contents:
  ğŸ“ backups (N/A)
  ğŸ“„ config.json (108 bytes)
  ğŸ“„ notes.json (156 bytes)

âœ… File operations completed successfully!
```

## Step 4: Environment Variables & Configuration

### Theory: Environment-Based Configuration

**Twelve-Factor App Principles**:
- **Config in Environment**: Store configuration in environment variables
- **Dev/Prod Parity**: Keep environments similar
- **Externalize Secrets**: Keep sensitive data out of code

**Configuration Hierarchy**:
1. Default values (in code)
2. Configuration files (.env)
3. Environment variables
4. Command line arguments

### Implementation

Create `.env`:
```env
NODE_ENV=development
DEBUG=true
APP_NAME=FileManagerCLI
MAX_FILE_SIZE=10485760
MAX_NOTES=1000
AUTO_BACKUP=true
DATA_PATH=./data
LOG_LEVEL=debug
```

Create `step4-environment.js`:
```javascript
import dotenv from 'dotenv';
import fs from 'fs/promises';
import path from 'path';
import os from 'os';

dotenv.config();

console.log('=== Environment Variables & Configuration ===\n');

class EnvironmentConfig {
  constructor() {
    this.nodeEnv = process.env.NODE_ENV || 'production';
    this.debug = process.env.DEBUG === 'true';
    this.appName = process.env.APP_NAME || 'FileManagerCLI';
    this.maxFileSize = parseInt(process.env.MAX_FILE_SIZE || '1048576');
    this.maxNotes = parseInt(process.env.MAX_NOTES || '100');
    this.dataPath = process.env.DATA_PATH || './data';
    
    console.log('âš™ï¸ Configuration loaded:');
    console.log(`  Environment: ${this.nodeEnv}`);
    console.log(`  Debug: ${this.debug}`);
    console.log(`  App: ${this.appName}`);
    console.log(`  Max File Size: ${this.formatBytes(this.maxFileSize)}`);
    console.log(`  Data Path: ${this.dataPath}`);
  }

  formatBytes(bytes) {
    const sizes = ['B', 'KB', 'MB', 'GB'];
    if (bytes === 0) return '0 B';
    const i = Math.floor(Math.log(bytes) / Math.log(1024));
    return (bytes / Math.pow(1024, i)).toFixed(2) + ' ' + sizes[i];
  }

  getPlatformPaths() {
    const platform = os.platform();
    const home = os.homedir();
    
    console.log('\nğŸ–¥ï¸ Platform-specific paths:');
    console.log(`  Platform: ${platform}`);
    console.log(`  Home: ${home}`);
    
    let appDataPath;
    switch (platform) {
      case 'win32':
        appDataPath = path.join(home, 'AppData', 'Roaming', this.appName);
        break;
      case 'darwin':
        appDataPath = path.join(home, 'Library', 'Application Support', this.appName);
        break;
      default:
        appDataPath = path.join(home, '.local', 'share', this.appName.toLowerCase());
    }
    
    console.log(`  App Data: ${appDataPath}`);
    return appDataPath;
  }

  async generateConfig() {
    console.log('\nğŸ“ Generating app config:');
    const configData = {
      environment: this.nodeEnv,
      debug: this.debug,
      paths: { data: this.dataPath },
      limits: { maxNotes: this.maxNotes, maxFileSize: this.maxFileSize },
      generated: new Date().toISOString()
    };
    
    await fs.writeFile('./data/app-config.json', JSON.stringify(configData, null, 2));
    console.log('  âœ… Configuration file created');
    return configData;
  }
}

async function demonstrateEnvironment() {
  try {
    const config = new EnvironmentConfig();
    config.getPlatformPaths();
    await config.generateConfig();
    console.log('\nâœ… Environment configuration completed!');
  } catch (error) {
    console.error('âŒ Error:', error.message);
  }
}

await demonstrateEnvironment();
```

**Output**:
```
=== Environment Variables & Configuration ===

âš™ï¸ Configuration loaded:
  Environment: development
  Debug: true
  App: FileManagerCLI
  Max File Size: 10.00 MB
  Data Path: ./data

ğŸ–¥ï¸ Platform-specific paths:
  Platform: win32
  Home: C:\Users\username
  App Data: C:\Users\username\AppData\Roaming\FileManagerCLI

ğŸ“ Generating app config:
  âœ… Configuration file created

âœ… Environment configuration completed!
```

## Step 5: Complete CLI Application

### Implementation

Create `index.js` - Complete File Manager CLI:
```javascript
#!/usr/bin/env node
import fs from 'fs/promises';
import fsSync from 'fs';
import path from 'path';
import chalk from 'chalk';
import dotenv from 'dotenv';

dotenv.config();

class FileManagerCLI {
  constructor() {
    this.dataDir = './data';
    this.notesFile = path.join(this.dataDir, 'notes.json');
    this.initializeApp();
  }

  async initializeApp() {
    if (!fsSync.existsSync(this.dataDir)) {
      await fs.mkdir(this.dataDir, { recursive: true });
    }
    if (!fsSync.existsSync(this.notesFile)) {
      await fs.writeFile(this.notesFile, JSON.stringify([], null, 2));
    }
  }

  async loadNotes() {
    try {
      const data = await fs.readFile(this.notesFile, 'utf8');
      return JSON.parse(data);
    } catch {
      return [];
    }
  }

  async saveNotes(notes) {
    await fs.writeFile(this.notesFile, JSON.stringify(notes, null, 2));
  }

  async addNote(title, content = '') {
    const notes = await this.loadNotes();
    const note = {
      id: Date.now(),
      title,
      content,
      created: new Date().toISOString()
    };
    notes.push(note);
    await this.saveNotes(notes);
    console.log(chalk.green('âœ… Note added successfully!'));
    console.log(chalk.blue(`   ID: ${note.id}`));
    console.log(chalk.blue(`   Title: ${note.title}`));
    return note;
  }

  async listNotes(filter) {
    const notes = await this.loadNotes();
    let filteredNotes = notes;
    
    if (filter) {
      filteredNotes = notes.filter(note => 
        note.title.toLowerCase().includes(filter.toLowerCase()) ||
        note.content.toLowerCase().includes(filter.toLowerCase())
      );
    }

    if (filteredNotes.length === 0) {
      console.log(chalk.yellow('ğŸ“ No notes found'));
      return;
    }

    console.log(chalk.blue(`ğŸ“š Found ${filteredNotes.length} notes:\n`));
    filteredNotes.forEach(note => {
      console.log(chalk.green(`[${note.id}] ${note.title}`));
      if (note.content) {
        console.log(chalk.gray(`   ${note.content.substring(0, 50)}...`));
      }
      console.log(chalk.gray(`   Created: ${new Date(note.created).toLocaleString()}\n`));
    });
  }

  async readNote(id) {
    const notes = await this.loadNotes();
    const note = notes.find(n => n.id === parseInt(id));
    
    if (!note) {
      console.log(chalk.red(`âŒ Note ${id} not found`));
      return;
    }

    console.log(chalk.blue(`ğŸ“– ${note.title}`));
    console.log(chalk.gray(`ID: ${note.id}`));
    console.log(chalk.gray(`Created: ${new Date(note.created).toLocaleString()}`));
    if (note.content) {
      console.log(chalk.white(`\n${note.content}`));
    }
  }

  async removeNote(id) {
    const notes = await this.loadNotes();
    const index = notes.findIndex(n => n.id === parseInt(id));
    
    if (index === -1) {
      console.log(chalk.red(`âŒ Note ${id} not found`));
      return;
    }

    const removed = notes.splice(index, 1)[0];
    await this.saveNotes(notes);
    console.log(chalk.green(`âœ… Removed "${removed.title}"`));
  }

  async searchNotes(query) {
    const notes = await this.loadNotes();
    const results = notes.filter(note => 
      note.title.toLowerCase().includes(query.toLowerCase()) ||
      note.content.toLowerCase().includes(query.toLowerCase())
    );

    console.log(chalk.blue(`ğŸ” Found ${results.length} notes matching "${query}":\n`));
    results.forEach(note => {
      console.log(chalk.green(`[${note.id}] ${note.title}`));
    });
  }

  showHelp() {
    console.log(chalk.blue('\nğŸ“– File Manager CLI\n'));
    console.log(chalk.green('Commands:'));
    console.log('  add <title> [content]  - Add a new note');
    console.log('  list [filter]          - List notes');
    console.log('  read <id>              - Read a note');
    console.log('  remove <id>            - Remove a note');
    console.log('  search <query>         - Search notes');
    console.log('  help                   - Show this help');
    
    console.log(chalk.yellow('\nExamples:'));
    console.log('  node index.js add "Meeting Notes" "Discuss project timeline"');
    console.log('  node index.js list');
    console.log('  node index.js search "project"');
  }

  async run() {
    const [,, command, ...args] = process.argv;

    try {
      switch (command) {
        case 'add':
          await this.addNote(args[0], args[1]);
          break;
        case 'list':
          await this.listNotes(args[0]);
          break;
        case 'read':
          await this.readNote(args[0]);
          break;
        case 'remove':
          await this.removeNote(args[0]);
          break;
        case 'search':
          await this.searchNotes(args[0]);
          break;
        default:
          this.showHelp();
      }
    } catch (error) {
      console.error(chalk.red(`âŒ ${error.message}`));
    }
  }
}

const cli = new FileManagerCLI();
await cli.run();
```

### CLI Testing Output

```bash
$ node index.js help
ğŸ“– File Manager CLI

Commands:
  add <title> [content]  - Add a new note
  list [filter]          - List notes
  read <id>              - Read a note
  remove <id>            - Remove a note
  search <query>         - Search notes

$ node index.js add "JavaScript Concepts" "Understanding closures and async programming"
âœ… Note added successfully!
   ID: 1753373045115
   Title: JavaScript Concepts

$ node index.js list
ğŸ“š Found 1 notes:

[1753373045115] JavaScript Concepts
   Understanding closures and async programming...
   Created: 7/24/2025, 10:04:05 PM

$ node index.js search "javascript"
ğŸ” Found 1 notes matching "javascript":

[1753373045115] JavaScript Concepts
```

## Lab Completion Summary

### âœ… Skills Mastered
- **Package.json Configuration**: Professional project setup with dependencies and scripts
- **Built-in Modules**: fs, path, os, util for system operations
- **File System Operations**: CRUD operations with JSON configuration
- **Environment Management**: .env files and platform-specific configuration
- **CLI Development**: Production-ready command-line interface

### ğŸ“ Files Created
```
lab2-cli-workshop/
â”œâ”€â”€ package.json              # Project configuration
â”œâ”€â”€ .env                      # Environment variables
â”œâ”€â”€ step1-package-json.js     # Package.json demo
â”œâ”€â”€ step2-builtin-modules.js  # Built-in modules demo
â”œâ”€â”€ step3-file-operations.js  # File operations demo
â”œâ”€â”€ step4-environment.js      # Environment config demo
â”œâ”€â”€ index.js                  # Complete CLI application
â””â”€â”€ data/                     # Application data
    â”œâ”€â”€ config.json
    â”œâ”€â”€ notes.json
    â””â”€â”€ backups/
```

### ğŸ¯ Real-World Applications
- **Backend Development**: Core skills for Node.js server applications
- **CLI Tools**: Building command-line utilities and automation
- **File Processing**: Batch operations and data transformation
- **DevOps**: Environment-based configuration for deployment

### ğŸ“š Next Steps
- **Lab 3**: Asynchronous Programming & Promises
- **Advanced Patterns**: Streams, events, and error handling
- **Testing**: Unit and integration testing strategies
- **Deployment**: Production deployment and monitoring

---

**ğŸ‰ Congratulations!** You've successfully built a production-ready CLI application demonstrating mastery of Node.js core modules and file system operations.

**ğŸ“ Navigation**: [â† Lab 1](./LAB1.md) | [Lab 3: Async Programming â†’](./LAB3.md) | [â† Main Guide](../EDUCATIONAL_GUIDE.md)
